# Insurance Module Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AMEEN INSURANCE HUB                          â”‚
â”‚                     Insurance Module v1.0                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER LAYER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¥ Admin Panel Users                                            â”‚
â”‚  â”œâ”€ Super Admin: Full access to all features                    â”‚
â”‚  â”œâ”€ Manager: View, create, edit insurance data                  â”‚
â”‚  â””â”€ Employee: View-only access                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PRESENTATION LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¨ UI Components (React + TypeScript)                           â”‚
â”‚  â”œâ”€ Sidebar Navigation                                           â”‚
â”‚  â”‚  â””â”€ Insurance Section                                         â”‚
â”‚  â”‚     â”œâ”€ Companies Menu Item                                    â”‚
â”‚  â”‚     â””â”€ Products Menu Item                                     â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€ Insurance Companies Page (/panel/insurance/companies)       â”‚
â”‚  â”‚  â”œâ”€ Grid Layout with Cards                                    â”‚
â”‚  â”‚  â”œâ”€ Search & Filter Controls                                  â”‚
â”‚  â”‚  â”œâ”€ Create/Edit Modal Forms                                   â”‚
â”‚  â”‚  â””â”€ Logo Upload Component                                     â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€ Insurance Products Page (/panel/insurance/products)         â”‚
â”‚     â”œâ”€ Grid Layout with Cards                                    â”‚
â”‚     â”œâ”€ Advanced Filters (Company, Category, Status)             â”‚
â”‚     â”œâ”€ Dynamic Features Management                               â”‚
â”‚     â””â”€ Create/Edit Modal Forms                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTHENTICATION LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” Security Middleware                                          â”‚
â”‚  â”œâ”€ JWT Token Verification                                       â”‚
â”‚  â”œâ”€ User Session Management                                      â”‚
â”‚  â””â”€ HTTP-only Cookie Handling                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTHORIZATION LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ›¡ï¸ Permission System                                            â”‚
â”‚  â”œâ”€ Permission Registry (10 insurance permissions)              â”‚
â”‚  â”œâ”€ Role-Based Access Control (RBAC)                            â”‚
â”‚  â””â”€ Permission Checks on All Routes                             â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“‹ Insurance Permissions:                                       â”‚
â”‚  â”œâ”€ insurance.companies.view                                     â”‚
â”‚  â”œâ”€ insurance.companies.create                                   â”‚
â”‚  â”œâ”€ insurance.companies.edit                                     â”‚
â”‚  â”œâ”€ insurance.companies.delete                                   â”‚
â”‚  â”œâ”€ insurance.products.view                                      â”‚
â”‚  â”œâ”€ insurance.products.create                                    â”‚
â”‚  â”œâ”€ insurance.products.edit                                      â”‚
â”‚  â””â”€ insurance.products.delete                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APPLICATION LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ API Endpoints (Next.js API Routes)                           â”‚
â”‚                                                                   â”‚
â”‚  Insurance Companies API:                                        â”‚
â”‚  â”œâ”€ GET    /api/insurance/companies      (List & Search)        â”‚
â”‚  â”œâ”€ POST   /api/insurance/companies      (Create)               â”‚
â”‚  â”œâ”€ GET    /api/insurance/companies/[id] (Details)              â”‚
â”‚  â”œâ”€ PUT    /api/insurance/companies/[id] (Update)               â”‚
â”‚  â””â”€ DELETE /api/insurance/companies/[id] (Delete)               â”‚
â”‚                                                                   â”‚
â”‚  Insurance Products API:                                         â”‚
â”‚  â”œâ”€ GET    /api/insurance/products       (List & Filter)        â”‚
â”‚  â”œâ”€ POST   /api/insurance/products       (Create)               â”‚
â”‚  â”œâ”€ GET    /api/insurance/products/[id]  (Details)              â”‚
â”‚  â”œâ”€ PUT    /api/insurance/products/[id]  (Update)               â”‚
â”‚  â””â”€ DELETE /api/insurance/products/[id]  (Delete)               â”‚
â”‚                                                                   â”‚
â”‚  File Upload API:                                                â”‚
â”‚  â””â”€ POST   /api/upload                   (Logo Upload)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BUSINESS LOGIC LAYER                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Data Validation & Processing                                 â”‚
â”‚  â”œâ”€ Input Validation (Required fields, formats)                 â”‚
â”‚  â”œâ”€ Business Rules Enforcement                                   â”‚
â”‚  â”œâ”€ Data Transformation (Uppercase codes, etc.)                 â”‚
â”‚  â””â”€ Error Handling & User Feedback                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA ACCESS LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¾ Database Queries (PostgreSQL)                                â”‚
â”‚  â”œâ”€ CRUD Operations                                              â”‚
â”‚  â”œâ”€ Complex Joins (Company + Product data)                      â”‚
â”‚  â”œâ”€ Search Queries (ILIKE patterns)                             â”‚
â”‚  â”œâ”€ Aggregations (Product counts)                               â”‚
â”‚  â””â”€ Transaction Management                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATABASE LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ—„ï¸ PostgreSQL Database                                          â”‚
â”‚                                                                   â”‚
â”‚  Tables:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ insurance_companies                                      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ PK  id                    SERIAL                         â”‚    â”‚
â”‚  â”‚ UQ  code                  VARCHAR(50)                    â”‚    â”‚
â”‚  â”‚     name_en               VARCHAR(255)                   â”‚    â”‚
â”‚  â”‚     name_ar               VARCHAR(255)                   â”‚    â”‚
â”‚  â”‚     description_en        TEXT                           â”‚    â”‚
â”‚  â”‚     description_ar        TEXT                           â”‚    â”‚
â”‚  â”‚     category              VARCHAR(100)                   â”‚    â”‚
â”‚  â”‚     cr_number             VARCHAR(100)                   â”‚    â”‚
â”‚  â”‚     license_number        VARCHAR(100)                   â”‚    â”‚
â”‚  â”‚     address_en            TEXT                           â”‚    â”‚
â”‚  â”‚     address_ar            TEXT                           â”‚    â”‚
â”‚  â”‚     website               VARCHAR(255)                   â”‚    â”‚
â”‚  â”‚     email                 VARCHAR(255)                   â”‚    â”‚
â”‚  â”‚     phone                 VARCHAR(50)                    â”‚    â”‚
â”‚  â”‚     logo_url              VARCHAR(500)                   â”‚    â”‚
â”‚  â”‚     is_active             BOOLEAN                        â”‚    â”‚
â”‚  â”‚     display_order         INTEGER                        â”‚    â”‚
â”‚  â”‚     created_at            TIMESTAMP                      â”‚    â”‚
â”‚  â”‚     updated_at            TIMESTAMP                      â”‚    â”‚
â”‚  â”‚ FK  created_by            INTEGER â†’ users(id)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ insurance_products                                       â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ PK  id                    SERIAL                         â”‚    â”‚
â”‚  â”‚ UQ  code                  VARCHAR(50)                    â”‚    â”‚
â”‚  â”‚ FK  company_id            INTEGER â†’ insurance_companies  â”‚    â”‚
â”‚  â”‚     name_en               VARCHAR(255)                   â”‚    â”‚
â”‚  â”‚     name_ar               VARCHAR(255)                   â”‚    â”‚
â”‚  â”‚     description_en        TEXT                           â”‚    â”‚
â”‚  â”‚     description_ar        TEXT                           â”‚    â”‚
â”‚  â”‚     category              VARCHAR(100)                   â”‚    â”‚
â”‚  â”‚     coverage_type         VARCHAR(100)                   â”‚    â”‚
â”‚  â”‚     features_en           TEXT[]                         â”‚    â”‚
â”‚  â”‚     features_ar           TEXT[]                         â”‚    â”‚
â”‚  â”‚     terms_en              TEXT                           â”‚    â”‚
â”‚  â”‚     terms_ar              TEXT                           â”‚    â”‚
â”‚  â”‚     logo_url              VARCHAR(500)                   â”‚    â”‚
â”‚  â”‚     is_active             BOOLEAN                        â”‚    â”‚
â”‚  â”‚     display_order         INTEGER                        â”‚    â”‚
â”‚  â”‚     created_at            TIMESTAMP                      â”‚    â”‚
â”‚  â”‚     updated_at            TIMESTAMP                      â”‚    â”‚
â”‚  â”‚ FK  created_by            INTEGER â†’ users(id)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  Indexes: 5 (Optimized for search and filtering)                â”‚
â”‚  Triggers: 2 (Automatic timestamp updates)                      â”‚
â”‚  Seed Data: 16 CMA-registered companies                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FILE STORAGE LAYER                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ File System                                                  â”‚
â”‚  â””â”€ /public/uploads/insurance_logo/                             â”‚
â”‚     â”œâ”€ company-logos/                                            â”‚
â”‚     â””â”€ product-logos/                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagrams

### Creating a New Insurance Company

```
User Action                 UI Layer                API Layer              Database
    â”‚                          â”‚                        â”‚                     â”‚
    â”œâ”€[1] Click "Add Company"â”€â†’â”‚                        â”‚                     â”‚
    â”‚                          â”œâ”€[2] Show Modal Formâ”€â”€â†’ â”‚                     â”‚
    â”‚                          â”‚                        â”‚                     â”‚
    â”œâ”€[3] Fill Form & Uploadâ”€â”€â†’â”‚                        â”‚                     â”‚
    â”‚       Logo                â”‚                        â”‚                     â”‚
    â”‚                          â”œâ”€[4] Upload Logoâ”€â”€â”€â”€â”€â”€â”€â”€â†’ /api/upload         â”‚
    â”‚                          â”‚                        â”œâ”€[5] Save Fileâ”€â”€â”€â”€â”€â”€â”€â†’ /uploads/
    â”‚                          â”‚â†â”€[6] Return URLâ”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
    â”‚                          â”‚                        â”‚                     â”‚
    â”œâ”€[7] Submit Formâ”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                        â”‚                     â”‚
    â”‚                          â”œâ”€[8] POST Requestâ”€â”€â”€â”€â”€â”€â†’â”‚                     â”‚
    â”‚                          â”‚   /api/insurance/      â”‚                     â”‚
    â”‚                          â”‚   companies            â”‚                     â”‚
    â”‚                          â”‚                        â”œâ”€[9] Verify Tokenâ”€â”€â”€â†’â”‚
    â”‚                          â”‚                        â”œâ”€[10] Check Permâ”€â”€â”€â”€â†’â”‚
    â”‚                          â”‚                        â”œâ”€[11] Validate Dataâ”€â”€â”‚
    â”‚                          â”‚                        â”œâ”€[12] INSERT Queryâ”€â”€â†’â”‚
    â”‚                          â”‚                        â”‚                     â”œâ”€[13] Save
    â”‚                          â”‚                        â”‚â†â”€[14] Return IDâ”€â”€â”€â”€â”€â”¤
    â”‚                          â”‚â†â”€[15] Success Responseâ”€â”¤                     â”‚
    â”‚                          â”œâ”€[16] Update UIâ”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                     â”‚
    â”‚                          â”œâ”€[17] Close Modalâ”€â”€â”€â”€â”€â”€â†’â”‚                     â”‚
    â”‚â†â”€[18] Show Success Msgâ”€â”€â”€â”¤                        â”‚                     â”‚
```

### Viewing Insurance Products with Filters

```
User Action                 UI Layer                API Layer              Database
    â”‚                          â”‚                        â”‚                     â”‚
    â”œâ”€[1] Navigate to Productsâ†’â”‚                        â”‚                     â”‚
    â”‚                          â”œâ”€[2] Initial Loadâ”€â”€â”€â”€â”€â”€â†’â”‚                     â”‚
    â”‚                          â”‚   GET /api/insurance/  â”‚                     â”‚
    â”‚                          â”‚   products             â”‚                     â”‚
    â”‚                          â”‚                        â”œâ”€[3] Verify Authâ”€â”€â”€â”€â†’â”‚
    â”‚                          â”‚                        â”œâ”€[4] Check Permâ”€â”€â”€â”€â”€â†’â”‚
    â”‚                          â”‚                        â”œâ”€[5] SELECT Queryâ”€â”€â”€â†’â”‚
    â”‚                          â”‚                        â”‚   JOIN companies    â”‚
    â”‚                          â”‚                        â”‚â†â”€[6] Return Rowsâ”€â”€â”€â”€â”¤
    â”‚                          â”‚â†â”€[7] Products Listâ”€â”€â”€â”€â”€â”¤                     â”‚
    â”‚                          â”œâ”€[8] Render Gridâ”€â”€â”€â”€â”€â”€â”€â†’â”‚                     â”‚
    â”‚                          â”‚                        â”‚                     â”‚
    â”œâ”€[9] Select Company Filterâ”‚                        â”‚                     â”‚
    â”‚                          â”œâ”€[10] GET with paramsâ”€â”€â†’â”‚                     â”‚
    â”‚                          â”‚   ?company_id=3        â”‚                     â”‚
    â”‚                          â”‚                        â”œâ”€[11] WHERE companyâ”€â”€â†’â”‚
    â”‚                          â”‚                        â”‚â†â”€[12] Filtered Dataâ”€â”¤
    â”‚                          â”‚â†â”€[13] Updated Listâ”€â”€â”€â”€â”€â”¤                     â”‚
    â”‚â†â”€[14] Show Filtered Gridâ”€â”¤                        â”‚                     â”‚
```

## Permission Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Permission Check Flow                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Request â†’ Authentication â†’ Authorization â†’ Route Handler â†’ Response
           (JWT Token)     (Permission)      (Business)
                              Check            Logic

Example: Editing a Company

1. User clicks "Edit" button on company card
   â†“
2. UI checks if user has 'insurance.companies.edit' permission
   â”œâ”€ Yes â†’ Show modal form
   â””â”€ No  â†’ Button is hidden (permission-based rendering)
   â†“
3. User submits form
   â†“
4. PUT /api/insurance/companies/[id]
   â†“
5. Middleware verifies JWT token
   â”œâ”€ Valid â†’ Continue
   â””â”€ Invalid â†’ 401 Unauthorized
   â†“
6. Check permission: userHasPermission(userId, 'insurance.companies.edit')
   â”œâ”€ Yes â†’ Continue
   â””â”€ No  â†’ 403 Forbidden
   â†“
7. Validate data and update database
   â†“
8. Return success response
   â†“
9. UI updates and shows success message
```

## Module Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ameen Hub Platform                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Existing Modules:                                          â”‚
â”‚  â”œâ”€ Users Management         âœ… Integrated                 â”‚
â”‚  â”œâ”€ Roles & Permissions      âœ… Integrated                 â”‚
â”‚  â”œâ”€ Customers Management     âœ… Integrated                 â”‚
â”‚  â”œâ”€ Messages System          âœ… Integrated                 â”‚
â”‚  â””â”€ File Upload Service      âœ… Integrated                 â”‚
â”‚                                                             â”‚
â”‚  New Module:                                                â”‚
â”‚  â””â”€ Insurance Management     âœ… ADDED                       â”‚
â”‚     â”œâ”€ Companies             âœ… Full CRUD                   â”‚
â”‚     â”œâ”€ Products              âœ… Full CRUD                   â”‚
â”‚     â”œâ”€ Logo Management       âœ… Integrated                 â”‚
â”‚     â””â”€ Permissions           âœ… Registered                  â”‚
â”‚                                                             â”‚
â”‚  Shared Services:                                           â”‚
â”‚  â”œâ”€ Authentication          (JWT + Cookies)                â”‚
â”‚  â”œâ”€ Authorization           (RBAC System)                  â”‚
â”‚  â”œâ”€ Database Connection     (PostgreSQL Pool)              â”‚
â”‚  â”œâ”€ File Upload            (Centralized Service)           â”‚
â”‚  â””â”€ Internationalization   (English + Arabic)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technology Stack

```
Frontend:
â”œâ”€ React 18+
â”œâ”€ TypeScript 5+
â”œâ”€ Next.js 15+ (App Router)
â”œâ”€ Tailwind CSS
â””â”€ Lucide Icons

Backend:
â”œâ”€ Next.js API Routes
â”œâ”€ Node.js Runtime
â””â”€ JWT Authentication

Database:
â”œâ”€ PostgreSQL 14+
â”œâ”€ pg (node-postgres)
â””â”€ Connection Pooling

Development:
â”œâ”€ pnpm (Package Manager)
â”œâ”€ ESLint (Linting)
â”œâ”€ TypeScript (Type Checking)
â””â”€ Git (Version Control)
```

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Layer 1: Network Security                               â”‚
â”‚  â””â”€ HTTPS (Production)                                   â”‚
â”‚                                                           â”‚
â”‚  Layer 2: Authentication                                  â”‚
â”‚  â”œâ”€ JWT Tokens (Signed)                                  â”‚
â”‚  â”œâ”€ HTTP-only Cookies (XSS Protection)                   â”‚
â”‚  â””â”€ Secure Flag (Production)                             â”‚
â”‚                                                           â”‚
â”‚  Layer 3: Authorization                                   â”‚
â”‚  â”œâ”€ Role-Based Access Control                            â”‚
â”‚  â”œâ”€ Permission Checks on Every Route                     â”‚
â”‚  â””â”€ UI-Level Permission Gates                            â”‚
â”‚                                                           â”‚
â”‚  Layer 4: Input Validation                               â”‚
â”‚  â”œâ”€ Required Field Checks                                â”‚
â”‚  â”œâ”€ Data Type Validation                                 â”‚
â”‚  â”œâ”€ Format Validation (emails, codes)                    â”‚
â”‚  â””â”€ SQL Injection Prevention (Parameterized Queries)     â”‚
â”‚                                                           â”‚
â”‚  Layer 5: Business Logic                                 â”‚
â”‚  â”œâ”€ Referential Integrity (Foreign Keys)                 â”‚
â”‚  â”œâ”€ Cascade Delete Rules                                 â”‚
â”‚  â””â”€ Unique Constraints                                    â”‚
â”‚                                                           â”‚
â”‚  Layer 6: Audit Trail                                    â”‚
â”‚  â”œâ”€ Created By Tracking                                  â”‚
â”‚  â”œâ”€ Timestamp Logging                                    â”‚
â”‚  â””â”€ Action Logging (Future)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Architecture Version**: 1.0  
**Last Updated**: January 30, 2026  
**Status**: Production Ready âœ…
